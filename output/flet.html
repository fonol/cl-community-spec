<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" href="/styles.css">
<link rel="stylesheet" href="/highlight-lisp/themes/github.css">
<script defer src="/scripts.js"></script>
<title>flet (CLCS)</title>

<link href="index.html#Top" rel="start" title="Top">
<link href="Data-and-Control-Flow-Dictionary.html#Data-and-Control-Flow-Dictionary" rel="up" title="Data and Control Flow Dictionary">
<link href="funcall.html#funcall" rel="next" title="funcall">
<link href="fmakunbound.html#fmakunbound" rel="prev" title="fmakunbound">


</head>

<body lang="en">

                        <div class="top">
                            <div class="search">
                                <svg height="20" width="20" viewBox="0 0 512 512"><path d="M221.09 64a157.09 157.09 0 10157.09 157.09A157.1 157.1 0 00221.09 64z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M338.29 338.29L448 448"/></svg>
                                <input type="text" oninput="search(event)" onkeydown="searchKeydown(event)" placeholder="Search for pages">
                                <div id="search__drop" onblur="hideSearch()"></div>
                            </div>
                            <a class="index-btn" href="index.html">
                                <svg height="20" width="20" viewBox="0 0 512 512"><title>Index</title><path d="M80 212v236a16 16 0 0016 16h96V328a24 24 0 0124-24h80a24 24 0 0124 24v136h96a16 16 0 0016-16V212" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path d="M480 256L266.89 52c-5-5.28-16.69-5.34-21.78 0L32 256M400 179V64h-48v69" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                            </a>
                        </div>
                        <div class="nav">
                            <a href="fmakunbound.html" class="nav-btn nav__prev ">
                                <svg height="14" width="14" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M328 112L184 256l144 144"/></svg>
                                fmakunbound
                            </a>
                            <a href="Data-and-Control-Flow-Dictionary.html" class="nav-btn nav__up ">
                                <svg height="14" width="14" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M112 328l144-144 144 144"/></svg>
                                Data and Control Flow Dictionary
                            </a>
                            <a href="funcall.html" class="nav-btn nav__next ">
                                funcall
                                <svg height="14" width="14" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M184 112l144 144-144 144"/></svg>
                            </a>
                        </div>
                    
<div class="section top-most">
<div class="node-type">Special Operator</div>
<h4 class="subsection">flet, labels, macrolet                                   </h4>

<p><code>flet</code>  <i><span class="roman">(</span>{(</i><i>function-name</i> 
				                  <i>lambda-list</i>
				      		  [[{<i>local-declaration</i>}* 
				  | <i>local-documentation</i>]]
				      		  {<i>local-form</i>}*<span class="roman">)</span>}*<span class="roman">)</span>
			  {<i>declaration</i>}* {<i>form</i>}*<br>
   &rArr;  <i>{<i>result</i>}*</i>
</p>
<p><code>labels</code>  <i><span class="roman">(</span>{(</i><i>function-name</i> 
				                  <i>lambda-list</i>
				      		  [[{<i>local-declaration</i>}* 
				  | <i>local-documentation</i>]]
				      		  {<i>local-form</i>}*<span class="roman">)</span>}*<span class="roman">)</span>
			  {<i>declaration</i>}* {<i>form</i>}*<br>
   &rArr;  <i>{<i>result</i>}*</i>
</p>
<p><code>macrolet</code>  <i><span class="roman">(</span>{(</i><i>name</i> 
				                  <i>lambda-list</i>
				      		  [[{<i>local-declaration</i>}* 
				  | <i>local-documentation</i>]]
				      		  {<i>local-form</i>}*<span class="roman">)</span>}*<span class="roman">)</span>
			  {<i>declaration</i>}* {<i>form</i>}*<br>
   &rArr;  <i>{<i>result</i>}*</i>
</p>
</div>
<div class="section">
<h4 class="subsubheading">Arguments and Values</h4>

<p><i>function-name</i>&mdash;a <i>function name</i>.
</p>
<p><i>name</i>&mdash;a <i>symbol</i>.
</p>
<p><i>lambda-list</i>&mdash;a <i>lambda list</i>; 
		      for <b>flet</b> and <b>labels</b>,
			 it is an <i>ordinary lambda list</i>;
		      for <a href="flet.html">macrolet</a>,
			 it is a <i>macro lambda list</i>.
</p>
<p><i>local-declaration</i>&mdash;a <b>declare</b> <i>expression</i>; not evaluated.
</p>
<p><i>declaration</i>&mdash;a <b>declare</b> <i>expression</i>; not evaluated.
</p>
<p><i>local-documentation</i>&mdash;a <i>string</i>; not evaluated.
</p>
<p><i>local-forms</i>, <i>forms</i>&mdash;an <i>implicit progn</i>.
</p>
<p><i>results</i>&mdash;the <i>values</i> of the <i>forms</i>.
</p>
</div>
<div class="section">
<h4 class="subsubheading">Description</h4>

<p><b>flet</b>, <b>labels</b>, and <a href="flet.html">macrolet</a>
define local <i>functions</i> and <i>macros</i>, and execute
<i>forms</i> using the local definitions.
<i>Forms</i> are executed  in order of occurrence.
</p>
<p>The body forms (but not the <i>lambda list</i>)
</p>
<p>of each <i>function</i> created by <b>flet</b> and <b>labels</b> 
and each <i>macro</i> created by <a href="flet.html">macrolet</a>
are enclosed in an <i>implicit block</i> whose name 
is the <i>function block name</i> of the <i>function-name</i> or <i>name</i>, 
as appropriate.
</p>
<p>The scope of the <i>declarations</i>
between
the list of local function/macro definitions and the body <i>forms</i>
in <b>flet</b> and <b>labels</b> 
does not include the bodies of the
locally defined <i>functions</i>, except that for <b>labels</b>,
any <b>inline</b>, <b>notinline</b>, or <b>ftype</b> declarations
that refer to the locally defined functions do apply to the local function
bodies. That is, their <i>scope</i> 
is the same as the function name that they
affect.  
</p>
<p>The scope of these <i>declarations</i> 
does not include the bodies of the macro expander
functions defined by <a href="flet.html">macrolet</a>.  
</p>
<dl compact="compact">
<dt>flet</dt>
<dd><p><b>flet</b> defines locally named <i>functions</i> and executes a series of
<i>forms</i> with these definition <i>bindings</i>.  Any number of
such local <i>functions</i> can be defined.  
</p>
<p>The <i>scope</i> of the name <i>binding</i> encompasses only the body.
Within the
body of <b>flet</b>, 
<i>function-names</i> matching those defined
by <b>flet</b> 
refer to the locally defined <i>functions</i> 
rather than to
the global function definitions of the same name.
</p>
<p>Also, within the scope of <b>flet</b>, 
global <i>setf expander</i> definitions of the <i>function-name</i>
defined by <b>flet</b> do not apply. 
Note that this applies to 
<tt>(defsetf <i>f</i> ...)</tt>, not
<tt>(defmethod (setf <i>f</i>) ...)</tt>.
</p>
<p>The names of <i>functions</i> defined by <b>flet</b> 
are in the <i>lexical environment</i>; they retain
their local definitions only within the body of <b>flet</b>.
The function definition bindings are visible only in
the body of <b>flet</b>, not the definitions themselves.  Within the
function definitions, local function names
that match those being
defined refer to <i>functions</i> or 
<i>macros</i> defined outside the <b>flet</b>.
<b>flet</b> can locally <i>shadow</i> a global function name,
and the new definition can refer to the global definition.
</p>
<p>Any <i>local-documentation</i> is attached to the corresponding local <i>function</i>
(if one is actually created) as a <i>documentation string</i>.
</p>
</dd>
<dt>labels</dt>
<dd><p><b>labels</b> is equivalent to <b>flet</b> except that
the scope of the defined function names for <b>labels</b> 
encompasses the function definitions themselves as well as the body.
</p>
</dd>
<dt>macrolet</dt>
<dd><p><a href="flet.html">macrolet</a> 
establishes local <i>macro</i> definitions,
using the same format used by <b>defmacro</b>.
</p>
<p>Within the body of <a href="flet.html">macrolet</a>, 
global <i>setf expander</i> definitions of the <i>names</i> defined by the 
<a href="flet.html">macrolet</a> do not apply; rather, <b>setf</b> expands the
<i>macro form</i> and recursively process the resulting <i>form</i>.
</p>
<p>The macro-expansion functions defined by <a href="flet.html">macrolet</a> 
are defined in the 
</p>
<p><i>lexical environment</i> in which the <a href="flet.html">macrolet</a> form appears.
Declarations and <a href="flet.html">macrolet</a> and 
<b>symbol-macrolet</b> definitions
affect the local macro definitions in a <a href="flet.html">macrolet</a>, but the
consequences are undefined if the local macro definitions reference
any local <i>variable</i> or <i>function</i> <i>bindings</i> that are visible in that
<i>lexical environment</i>.
</p>
<p>Any <i>local-documentation</i> is attached to the corresponding local <i>macro function</i>
as a <i>documentation string</i>.
</p>
</dd>
</dl>

</div>
<div class="section">
<h4 class="subsubheading">Examples</h4>

<div class="example">
<pre class="example"><code> (defun foo (x flag)
   (macrolet ((fudge (z)
                 ;The parameters x and flag are not accessible
                 ; at this point; a reference to flag would be to
                 ; the global variable of that name.
                 ` (if flag (* ,z ,z) ,z)))
    ;The parameters x and flag are accessible here.
     (+ x
        (fudge x)
        (fudge (+ x 1)))))
 &equiv;
 (defun foo (x flag)
   (+ x
      (if flag (* x x) x)
      (if flag (* (+ x 1) (+ x 1)) (+ x 1))))
</code>
</pre></div>

<p>after macro expansion.  The occurrences of <tt>x</tt> and <tt>flag</tt> legitimately
refer to the parameters of the function <tt>foo</tt> because those parameters are
visible at the site of the macro call which produced the expansion.
</p>
<div class="example">
<pre class="example"><code> (flet ((flet1 (n) (+ n n)))
    (flet ((flet1 (n) (+ 2 (flet1 n))))
      (flet1 2))) &rArr;  6

 (defun dummy-function () 'top-level) &rArr;  DUMMY-FUNCTION 
 (funcall #'dummy-function) &rArr;  TOP-LEVEL 
 (flet ((dummy-function () 'shadow)) 
      (funcall #'dummy-function)) &rArr;  SHADOW 
 (eq (funcall #'dummy-function) (funcall 'dummy-function))
&rArr;  <i>true</i> 
 (flet ((dummy-function () 'shadow))
   (eq (funcall #'dummy-function)
       (funcall 'dummy-function)))
&rArr;  <i>false</i> 

 (defun recursive-times (k n)
   (labels ((temp (n) 
              (if (zerop n) 0 (+ k (temp (1- n))))))
     (temp n))) &rArr;  RECURSIVE-TIMES
 (recursive-times 2 3) &rArr;  6

 (defmacro mlets (x &amp;environment env) 
    (let ((form `(babbit ,x)))
      (macroexpand form env))) &rArr;  MLETS
 (macrolet ((babbit (z) `(+ ,z ,z))) (mlets 5)) &rArr;  10
</code>
</pre></div>

<div class="example">
<pre class="example"><code> (flet ((safesqrt (x) (sqrt (abs x))))
  ;; The safesqrt function is used in two places.
   (safesqrt (apply #'+ (map 'list #'safesqrt '(1 2 3 4 5 6)))))
&rArr;  3.291173
</code>
</pre></div>

<div class="example">
<pre class="example"><code> (defun integer-power (n k)     
   (declare (integer n))         
   (declare (type (integer 0 *) k))
   (labels ((expt0 (x k a)
              (declare (integer x a) (type (integer 0 *) k))
              (cond ((zerop k) a)
                    ((evenp k) (expt1 (* x x) (floor k 2) a))
                    (t (expt0 (* x x) (floor k 2) (* x a)))))
            (expt1 (x k a)
              (declare (integer x a) (type (integer 0 *) k))
              (cond ((evenp k) (expt1 (* x x) (floor k 2) a))
                    (t (expt0 (* x x) (floor k 2) (* x a))))))
    (expt0 n k 1))) &rArr;  INTEGER-POWER
</code>
</pre></div>

<div class="example">
<pre class="example"><code> (defun example (y l)
   (flet ((attach (x)
            (setq l (append l (list x)))))
     (declare (inline attach))
     (dolist (x y)
       (unless (null (cdr x))
         (attach x)))
     l))

 (example '((a apple apricot) (b banana) (c cherry) (d) (e))
          '((1) (2) (3) (4 2) (5) (6 3 2)))
&rArr;  ((1) (2) (3) (4 2) (5) (6 3 2) (A APPLE APRICOT) (B BANANA) (C CHERRY))
</code>
</pre></div>

</div>
<div class="section">
<h4 class="subsubheading">See Also</h4>

<p><b>declare</b>,
<a href="defmacro.html#defmacro">defmacro</a>, 

<a href="defun.html#defun">defun</a>, 

<a href="documentation.html">documentation; (setf documentation)</a>, 

<a href="let.html">let; let*</a>, 

<a href="Evaluation.html#Evaluation">Evaluation</a>,
<a href="Syntactic-Interaction-of-Documentation-Strings-and-Declarations.html#Syntactic-Interaction-of-Documentation-Strings-and-Declarations">Syntactic Interaction of Documentation Strings and Declarations</a>
</p>
</div>
<div class="section">
<h4 class="subsubheading">Notes</h4>

<p>It is not possible to define recursive <i>functions</i> with <b>flet</b>.
<b>labels</b> can be used to define mutually recursive <i>functions</i>.
</p>
<p>If a <a href="flet.html">macrolet</a> <i>form</i> is a <i>top level form</i>,
the body <i>forms</i> are also processed as <i>top level forms</i>.
See <a href="File-Compilation.html#File-Compilation">File Compilation</a>.
</p>



</div>

                    <div class="section">
                        <h3>Backlinks</h3>
                        <a href="defun.html">defun</a>, <a href="function-_0028Special-Operator_0029.html">function (Special Operator)</a>, <a href="lambda_002dlist_002dkeywords.html">lambda-list-keywords</a>
                    </div>
                
</body>
<script type="text/javascript" src="/highlight-lisp/highlight-lisp.js"></script>
</html>
