<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<link rel="icon" type="image/x-icon" href="/favicon.ico">
<link rel="stylesheet" href="/styles.css">
<link rel="stylesheet" href="/highlight-lisp/themes/github.css">
<script defer src="/scripts.js"></script>
<title>defgeneric (CLCS)</title>

<link href="index.html#Top" rel="start" title="Top">
<link href="Objects-Dictionary.html#Objects-Dictionary" rel="up" title="Objects Dictionary">
<link href="defmethod.html#defmethod" rel="next" title="defmethod">
<link href="defclass.html#defclass" rel="prev" title="defclass">


</head>

<body lang="en">

                        <div class="top">
                            <div class="search">
                                <svg height="20" width="20" viewBox="0 0 512 512"><path d="M221.09 64a157.09 157.09 0 10157.09 157.09A157.1 157.1 0 00221.09 64z" fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="32"/><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M338.29 338.29L448 448"/></svg>
                                <input type="text" oninput="search(event)" onkeydown="searchKeydown(event)" placeholder="Search for pages">
                                <div id="search__drop" onblur="hideSearch()"></div>
                            </div>
                            <a class="index-btn" href="index.html">
                                <svg height="20" width="20" viewBox="0 0 512 512"><title>Index</title><path d="M80 212v236a16 16 0 0016 16h96V328a24 24 0 0124-24h80a24 24 0 0124 24v136h96a16 16 0 0016-16V212" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/><path d="M480 256L266.89 52c-5-5.28-16.69-5.34-21.78 0L32 256M400 179V64h-48v69" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"/></svg>
                            </a>
                        </div>
                        <div class="nav">
                            <a href="defclass.html" class="nav-btn nav__prev ">
                                <svg height="14" width="14" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M328 112L184 256l144 144"/></svg>
                                defclass
                            </a>
                            <a href="Objects-Dictionary.html" class="nav-btn nav__up ">
                                <svg height="14" width="14" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M112 328l144-144 144 144"/></svg>
                                Objects Dictionary
                            </a>
                            <a href="defmethod.html" class="nav-btn nav__next ">
                                defmethod
                                <svg height="14" width="14" viewBox="0 0 512 512"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M184 112l144 144-144 144"/></svg>
                            </a>
                        </div>
                    
<a name="defgeneric"></a>
<a name="defgeneric-_005bMacro_005d"></a>
<div class="section top-most">
<div class="node-type">Macro</div>
<h4 class="subsection">defgeneric                                                          </h4>

<p><code>defgeneric</code>  <i>function-name gf-lambda-list
	  		  [[!<i>option</i> | {!<i>method-description</i>}*</i>]]<br>
   &rArr;  <i>new-generic</i>
</p>
<table>
<tr><td><i>option</i></td><td>::=<span class="roman">(</span><tt><span class="nolinebreak">:argument-precedence-order</span></tt></td><td>{<i><span class="nolinebreak">parameter-name</span></i>}^+<span class="roman">)</span></td><td>|</td></tr>
<tr><td><span class="roman">(</span><b>declare</b></td><td>{<i><span class="nolinebreak">gf-declaration</span></i>}^+<span class="roman">)</span></td><td>|</td></tr>
<tr><td><span class="roman">(</span><tt>:documentation</tt></td><td><i><span class="nolinebreak">gf-documentation</span></i><span class="roman">)</span></td><td>|</td></tr>
<tr><td><span class="roman">(</span><tt><span class="nolinebreak">:method-combination</span></tt></td><td><i><span class="nolinebreak">method-combination</span></i></td><td>{<i><span class="nolinebreak">method-combination-argument</span></i>}*<span class="roman">)</span> |</td></tr>
<tr><td><span class="roman">(</span><tt><span class="nolinebreak">:generic-function-class</span></tt></td><td><i><span class="nolinebreak">generic-function-class</span></i><span class="roman">)</span></td><td>|</td></tr>
<tr><td><span class="roman">(</span><tt><span class="nolinebreak">:method-class</span></tt></td><td><i><span class="nolinebreak">method-class</span></i><span class="roman">)</span></td></tr>
</table>
<table>
<tr><td><i><span class="nolinebreak">method-description</span></i></td><td>::=<span class="roman">(</span><tt>:method</tt></td><td>{<i><span class="nolinebreak">method-qualifier</span></i>}* <i>specialized-lambda-list</i> [[{<i>declaration</i>}* | <i>documentation</i>]] {<i>form</i>}*<span class="roman">)</span></td></tr>
</table>
<a name="Arguments-and-Values_003a_003a-114"></a>
</div>
<div class="section">
<h4 class="subsubheading">Arguments and Values</h4>

<p><i>function-name</i>&mdash;a <i>function name</i>.
</p>
<p><i>generic-function-class</i>&mdash;a <i>non-nil</i> <i>symbol</i> naming a <i>class</i>.
</p>
<p><i>gf-declaration</i>&mdash;an <b>optimize</b> <i>declaration specifier</i>;
  other <i>declaration specifiers</i> are not permitted.
</p>
<p><i>gf-documentation</i>&mdash;a <i>string</i>; not evaluated.
</p>
<p><i>gf-lambda-list</i>&mdash;a <i>generic function lambda list</i>.
</p>
<p><i>method-class</i>&mdash;a <i>non-nil</i> <i>symbol</i> naming a <i>class</i>.
</p>
<p><i>method-combination-argument</i>&mdash;an <i>object.</i>
</p>
<p><i>method-combination-name</i>&mdash;a <i>symbol</i> 
				  naming a <i>method combination</i> <i>type</i>.
</p>
<p><i>method-qualifiers</i>,
<i>specialized-lambda-list</i>,
<i>declarations</i>,
<i>documentation</i>,
<i>forms</i>&mdash;as per <b>defmethod</b>.
</p>
<p><i>new-generic</i>&mdash;the <i>generic function</i> <i>object</i>.
</p>
<p><i>parameter-name</i>&mdash;a <i>symbol</i> that names a <i>required parameter</i> 
			 in the <i>lambda-list</i>.
  (If the <tt>:argument-precedence-order</tt> option is specified,
   each <i>required parameter</i> in the <i>lambda-list</i>
   must be used exactly once as a <i>parameter-name</i>.)
</p>
<a name="Description_003a_003a-153"></a>
</div>
<div class="section">
<h4 class="subsubheading">Description</h4>

<p>The macro <b>defgeneric</b> is used to define a <i>generic function</i>
or to specify options and declarations that pertain 
to a <i>generic function</i> as a whole.
</p>
<p>If <i>function-name</i> is a 
<i>list</i> it must be of the form <tt>(setf <i>symbol</i>)</tt>.
If <tt>(fboundp <i>function-name</i>)</tt> is <i>false</i>, a new
<i>generic function</i> is created.  
</p>
<p>If <tt>(fdefinition <i>function-name</i>)</tt> is a <i>generic function</i>, that 
</p>
<p><i>generic function</i>
is modified.  If <i>function-name</i> names 
an <i>ordinary function</i>,
a <i>macro</i>, or a <i>special operator</i>, 
an error is signaled.
</p>
<p>The effect of the <b>defgeneric</b> macro is as if the following three
steps were performed: first, 
<i>methods</i> defined by previous <b>defgeneric</b> <i>forms</i> are removed; 
</p>
<p>[Reviewer Note by Barmar: Shouldn&rsquo;t this (second) be first?]
second, <b>ensure-generic-function</b>
is called; and finally, <i>methods</i> specified by the current
<b>defgeneric</b> <i>form</i> are added to the <i>generic function</i>. 
</p>
<p>Each <i>method-description</i> defines a <i>method</i> on the <i>generic function</i>.
The <i>lambda list</i> of each <i>method</i> must be congruent with the 
<i>lambda list</i>
specified by the <i>gf-lambda-list</i> option.  
If no <i>method</i> descriptions are specified and a <i>generic function</i> of the same
name does not already exist, a <i>generic function</i> with no 
<i>methods</i> is created.
</p>
<p>The <i>gf-lambda-list</i> argument of <b>defgeneric</b> specifies the shape of
<i>lambda lists</i> for the <i>methods</i> on this <i>generic function</i>.
All <i>methods</i> on the resulting 
<i>generic function</i> must have
<i>lambda lists</i> that are congruent with this shape.  If a <b>defgeneric</b>
form is evaluated and some 
<i>methods</i> for that <i>generic function</i>
have <i>lambda lists</i> that are not congruent with that given in
the <b>defgeneric</b> form, an error is signaled.  For further details
on method congruence, see <a href="Congruent-Lambda_002dlists-for-all-Methods-of-a-Generic-Function.html#Congruent-Lambda_002dlists-for-all-Methods-of-a-Generic-Function">Congruent Lambda-lists for all Methods of a Generic Function</a>.
</p>
<p>The <i>generic function</i> passes to the 
<i>method</i> all the argument values passed to
it, and only those; default values are not supported.
Note that optional and keyword arguments in method definitions, however,
can have default initial value forms and can use supplied-p parameters. 
</p>
<p>The following options are provided.  
</p>
<p>Except as otherwise noted, 
</p>
<p>a given option may occur only once.
</p>
<dl compact="compact">
<dt><tt>*</tt></dt>
<dd><p>The <tt>:argument-precedence-order</tt> option is used to specify the
order in which the required arguments in a call to the <i>generic function</i>
are tested for specificity when selecting a particular
<i>method</i>. Each required argument, as specified in the <i>gf-lambda-list</i>
argument, must be included exactly once as a <i>parameter-name</i>
so that the full and unambiguous precedence order is
supplied.  If this condition is not met, an error is signaled.
</p>
<p>[Reviewer Note by Barmar: What is the default order?]
</p>
</dd>
<dt><tt>*</tt></dt>
<dd><p>The <b>declare</b> option is used to specify declarations that pertain
to the <i>generic function</i>.
</p>
<p>An <b>optimize</b> <i>declaration specifier</i> is allowed.
It specifies whether method selection should be optimized for 
speed or space, but it has no effect on <i>methods</i>.
To control how a <i>method</i> is optimized, an <b>optimize</b>
declaration must be placed directly in the <b>defmethod</b> <i>form</i>
or method description.  The optimization qualities <b>speed</b> and
<b>space</b> are the only qualities this standard requires, but an
implementation can extend the object system to recognize other qualities.  
A simple implementation that has only one method selection technique 
and ignores <b>optimize</b> <i>declaration specifiers</i> is valid.
</p>
<p>The <b>special</b>, <b>ftype</b>, <b>function</b>, <b>inline</b>,
<b>notinline</b>, and <b>declaration</b> declarations are not permitted.
Individual implementations can extend the <b>declare</b> option to
support additional declarations.
</p>
<p>[Editorial Note by KMP: Does &ldquo;additional&rdquo; mean including special, ftype, etc.?  
Or only other things that are not mentioned here?]
If an implementation notices a <i>declaration specifier</i> that it does
not support and that has not been proclaimed as a non-standard 
<i>declaration identifier</i> name in a <b>declaration</b> <i>proclamation</i>, 
it should issue a warning. 
[Editorial Note by KMP: The wording of this previous sentence,
particularly the word &ldquo;and&rdquo; suggests to me that you can &lsquo;proclaim declaration&rsquo;
of an unsupported declaration (e.g., ftype) in order to suppress the warning.
That seems wrong.  Perhaps it instead means to say &ldquo;does not support or 
is both undefined and not proclaimed declaration.&rdquo;]
</p>
<p>The <b>declare</b> option may be specified more than once.
The effect is the same as if the lists of <i>declaration specifiers</i> 
had been appended together into a single list and specified as a 
single <b>declare</b> option.
</p>
</dd>
<dt><tt>*</tt></dt>
<dd><p>The <tt>:documentation</tt> argument is a <i>documentation string</i>
to be attached to the <i>generic function</i> <i>object</i>, 
and to be attached with kind <b>function</b> to the <i>function-name</i>.
</p>
</dd>
<dt><tt>*</tt></dt>
<dd><p>The <tt>:generic-function-class</tt> option may be used to specify that
the <i>generic function</i> is to have a different <i>class</i> than
the default provided by the system (the <i>class</i> <b>standard-generic-function</b>).
The <i>class-name</i> argument is the name of a <i>class</i> that can be the
<i>class</i> of a <i>generic function</i>.  If <i>function-name</i> specifies
an existing <i>generic function</i> that has a different value for the
<tt>:generic-function-class</tt> argument and the new generic function 
<i>class</i> is compatible with the old, <b>change-class</b> is called 
to change the <i>class</i> of the <i>generic function</i>; 
otherwise an error is signaled.
</p>
</dd>
<dt><tt>*</tt></dt>
<dd><p>The <tt>:method-class</tt> option is used to specify that all <i>methods</i> on
this <i>generic function</i> are to have a different <i>class</i> from the 
default provided by the system (the <i>class</i> <b>standard-method</b>).
The <i>class-name</i> argument is the name of a <i>class</i> that is capable 
of being the <i>class</i> of a <i>method</i>.
</p>
<p>[Reviewer Note by Barmar: Is <b>change-class</b> called on existing methods?]
</p>
</dd>
<dt><tt>*</tt></dt>
<dd><p>The <tt>:method-combination</tt> option is followed by a symbol that
names a type of method combination.  The arguments (if any) that
follow that symbol depend on the type of method combination.  Note
that the standard method combination type does not support any
arguments.  However, all types of method combination defined by the
short form of <b>define-method-combination</b> accept an optional
argument named <i>order</i>, defaulting to <tt>:most-specific-first</tt>,
where a value of <tt>:most-specific-last</tt> reverses
the order of the primary <i>methods</i> without affecting the order of the
auxiliary <i>methods</i>.
</p>
</dd>
</dl>

<p>The <i>method-description</i> arguments define <i>methods</i> that will
be associated with the <i>generic function</i>.  The <i>method-qualifier</i>
and <i>specialized-lambda-list</i> arguments in a method description
are the same as for <b>defmethod</b>.
</p>
<p>The <i>form</i> arguments specify the method body.  The body of the
<i>method</i> is enclosed in an <i>implicit block</i>.
If <i>function-name</i> is a <i>symbol</i>, this block bears the same name as
the <i>generic function</i>.  If <i>function-name</i> is a 
<i>list</i> of the
form <tt>(setf <i>symbol</i>)</tt>, the name of the block is <i>symbol</i>.  
</p>
<p>Implementations can extend <b>defgeneric</b> to include other options.
It is required that an implementation signal an error if
it observes an option that is not implemented locally.
</p>
<p><b>defgeneric</b> is not required to perform any compile-time side effects.
In particular, the <i>methods</i> are not installed for invocation during 
compilation.  An <i>implementation</i> may choose to store information about
the <i>generic function</i> for the purposes of compile-time error-checking
(such as checking the number of arguments on calls, or noting that a definition
 for the function name has been seen).
</p>
<a name="Examples_003a_003a-108"></a>
</div>
<div class="section">
<h4 class="subsubheading">Examples</h4>

<a name="Exceptional-Situations_003a_003a-38"></a>
</div>
<div class="section">
<h4 class="subsubheading">Exceptional Situations</h4>

<p>If <i>function-name</i> names an <i>ordinary function</i>, a <i>macro</i>,
or a <i>special operator</i>, an error of <i>type</i> <b>program-error</b> is signaled.
</p>
<p>Each required argument, as specified in the <i>gf-lambda-list</i>
argument, must be included exactly once as a <i>parameter-name</i>,
or an error of <i>type</i> <b>program-error</b> is signaled.
</p>
<p>The <i>lambda list</i> of each <i>method</i> specified by a 
<i>method-description</i> must be congruent with the <i>lambda list</i> specified
by the <i>gf-lambda-list</i> option, or
an error of <i>type</i> <b>error</b> is signaled.
</p>
<p>If a <b>defgeneric</b> form is evaluated and some <i>methods</i> for
that <i>generic function</i> have <i>lambda lists</i> that are not congruent with
that given in the <b>defgeneric</b> form, 
an error of <i>type</i> <b>error</b> is signaled.
</p>
<p>A given <i>option</i> may occur only once,
or an error of <i>type</i> <b>program-error</b> is signaled.
</p>
<p>[Reviewer Note by Barmar: This says that an error is signaled if you specify the same generic
    function class as it already has!]
If <i>function-name</i> specifies an existing <i>generic function</i> 
that has a different value for the <tt>:generic-function-class</tt> 
argument and the new generic function <i>class</i> is compatible with the
old, <b>change-class</b> is called to change the <i>class</i> of 
the <i>generic function</i>; otherwise an error of <i>type</i> <b>error</b> is signaled.
</p>
<p>Implementations can extend <b>defgeneric</b> to include other options.
It is required that an implementation 
signal an error of <i>type</i> <b>program-error</b> if
it observes an option that is not implemented locally.
</p>
<a name="See-Also_003a_003a-135"></a>
</div>
<div class="section">
<h4 class="subsubheading">See Also</h4>

<p><a href="defmethod.html#defmethod">defmethod</a>
,
<a href="documentation.html">documentation; (setf documentation)</a>
,
<a href="ensure_002dgeneric_002dfunction.html#ensure_002dgeneric_002dfunction">ensure-generic-function</a>
,
</p>
<p><b>generic-function</b>,
</p>
<p><a href="Congruent-Lambda_002dlists-for-all-Methods-of-a-Generic-Function.html#Congruent-Lambda_002dlists-for-all-Methods-of-a-Generic-Function">Congruent Lambda-lists for all Methods of a Generic Function</a>
</p>



</body>
<script type="text/javascript" src="/highlight-lisp/highlight-lisp.js"></script>
</html>

</div>